<? /* licenseBilugCMS (http://www.bilug.it) - Content Management System for dynamic web sitesCopyright (C) 2005-2008  Federico Villa and Alessio Loro PianaThis program is free software: you can redistribute it and/or modifyit under the terms of the GNU General Public License as published bythe Free Software Foundation, either version 2 of the License.This program is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See theGNU General Public License for more details.You should have received a copy of the GNU General Public Licensealong with this program.  If not, see <http://www.gnu.org/licenses/>.For reference, contact bilugcms@vilnet.itlicense */ ?><button type="button" class="btn-navbar">	<span class="icon-bar"></span>	<span class="icon-bar"></span>	<span class="icon-bar"></span></button><div class="blocco blocco-menu-tendina"><?php//query dove estraggo le voci principali del menu alto	$query1="		SELECT m.id, m.titolo, m.link, m.posizione, m.tipolink, m.descrizione, m.img 		FROM menutipo AS m 		INNER JOIN lingue AS l ON l.id = m.id_lingua 		WHERE m.tipo='t' AND m.idpadre=0 AND l.sigla = '$lingua_query'		ORDER BY m.posizione	";	$risultato1=mysql_query($query1);	$row1=mysql_num_rows($risultato1);	//$principale=mysql_fetch_row($risultato1);			//cero il menu con <ul> incatenati		if($row1>0)		{			echo"<ul class=\"menu\" id=\"menu\">";			$cont = 1;			while($principale=mysql_fetch_row($risultato1)) {				$class_link = "";				if ( $cont == 1 ) $class_link .= " first_link ";				elseif ( $cont == $row1 ) $class_link .= " last_link ";								if ( 					( basename( $_SERVER["REQUEST_URI"] ) == basename( $principale[2] ) ) OR  					( basename( $_SERVER["REQUEST_URI"] ) == '' AND basename( $principale[2] ) == 'index.php' ) 				) $class_link .= " link_uri ";								$testo_menu = ( $principale[6] != '' ) ?					"<span class=\"menuimg\"><img src=\"$principale[6]\" alt=\"\" height=\"\" width=\"\"></span> $principale[1]" :					$principale[1] ;								//controllo se ha almeno un sottomenu				$querysot = "SELECT id FROM menutipo WHERE tipo='t' AND idpadre = $principale[0] ORDER BY posizione LIMIT 1";				$risultatosot=mysql_query($querysot);				$rowsot=mysql_num_rows($risultatosot);								$title = "";				if ( $principale[5] != '' )					$title = "title=\"$principale[5]\"";				echo "<li class=\"$class_link\">";								switch($principale[4]) {					case "nw": 					case "st": 					case "gl": 					case "hm": 					case "sc": 					case "in": 					case "ec": echo "<a $title href=\"$principale[2]\" class=\"menulink\">$testo_menu</a>"; break;										case "ex": echo "<a $title target=\"_blank\" href=\"$principale[2]\" class=\"menulink\">$testo_menu</a>"; break;										default:   echo "<a $title href=\"$principale[2]\" class=\"menulink\">$testo_menu</a>"; break;				}								if( $rowsot > 0 )					sottovoci($principale[0]);								echo "</li>";								$cont++;			}									echo "</ul>";		}?></div><?phpfunction sottovoci($id){	$query = "SELECT id, titolo, link, idpadre, posizione, tipolink, descrizione, img FROM menutipo WHERE tipo='t' AND idpadre = '$id' ORDER BY posizione";	$risultato = mysql_query($query);	$row = mysql_num_rows($risultato);			if( $row > 0 ) {			echo"<ul>";			while($voci=mysql_fetch_row($risultato)) {			$class_link = "";			if ( $cont == 1 )				$class_link = " first_link ";			elseif ( $cont == $row1 )				$class_link = " last_link ";			if ( 				( basename( $_SERVER["REQUEST_URI"] ) == basename( $voci[2] ) ) OR  				( basename( $_SERVER["REQUEST_URI"] ) == '' AND basename( $voci[2] ) == 'index.php' ) 			) $class_link .= " link_uri ";						$menuimg = substr($voci[7], 0, strlen($voci[7])-1);						$testo_menu = ( $menuimg != '' ) ?				"<span class=\"menuimg\"><img src=\"$menuimg\" alt=\"\" height=\"\" width=\"\"></span> $voci[1]" :				$voci[1] ;						//controllo se ha almeno un sottomenu			$conte="SELECT id FROM menutipo WHERE tipo='t' AND idpadre='$voci[0]' LIMIT 1";			$cont=mysql_query($conte);			$row=mysql_num_rows($cont);						$title = "";			if ( $voci[6] != '' )				$title = "title=\"$voci[6]\"";								echo "<li class=\"$class_link\">";						switch($voci[5])			{				case "nw": 				case "st": 				case "gl":				case "hm": 				case "sc": 				case "in": 				case "ec": echo"<a $title href=\"$voci[2]\">$testo_menu</a>"; break;								case "ex": echo"<a target=\"_blank\" $title href=\"$voci[2]\">$testo_menu</a>"; break;								default:   echo "<a $title href=\"javascript:void()\">$testo_menu</a>"; break;			}						if( $row > 0 )				sottovoci( $voci[0] );						echo "</li>";						$cont++;		}		echo"</ul>";		return 0;	} }?>